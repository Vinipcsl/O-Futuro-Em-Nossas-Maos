<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doador</title>
    <link rel="stylesheet" href="./estilo.css">
</head>
<body>
    <header>
        <nav>
            <div>
                <a class="navbar-brand" href="index.html" style="color: white;">
                    <img class="iconPageNav" src="./imagens do projeto/Logo do projeto.jpg">
                    Futuro em Nossas Mãos<br>
                </a>
            </div>
            <div id="right-links">
                <a href="index.html">Home</a>
                <a href="pagina1.html">Doador</a>
                <a href="pagina2.html">Donatário</a>
                <a href="pagina3.html">Contatos</a>
            </div>
        </nav>
    </header>
    <div>
        <h1 style="color: #F5A818;">Pagina de Doação</h1>
    </div>
    <div class="container">
        <div class="form-container">
            <h1>Cadastro</h1>
            <form id="doadorForm">
                <input type="hidden" id="doadorId">
                <label for="nome">Nome:</label>
                <input type="text" id="nome" required>
                <label for="sobreNome">Sobrenome:</label>
                <input type="text" id="sobrenome" required>
                <label for="telefone">Telefone:</label>
                <input type="text" id="telefone" required>
                <button type="submit">Salvar</button>
            </form>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Sobrenome</th>
                <th>Telefone</th>
            </tr>
        </thead>
        <tbody id="doadores"></tbody>
    </table>

    <script>
      const API_URL = "http://localhost:3000/doadores";

      const doadorForm = document.getElementById("doadorForm");
      const doadorIdInput = document.getElementById("doadorId");
      const doadorNomeInput = document.getElementById("nome");
      const doadorSobrenomeInput = document.getElementById("sobrenome");
      const doadorTelefoneInput = document.getElementById("telefone");
      const doadoresTable = document.getElementById("doadores");

      doadorForm.addEventListener("submit", async (event) => {
        event.preventDefault();

        const doadorId = doadorIdInput.value;
        const nome = doadorNomeInput.value;
        const sobrenome = doadorSobrenomeInput.value;
        const telefone = doadorTelefoneInput.value;

        if (doadorId) {
          await fetch(API_URL + "/" + doadorId, {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ nome, sobrenome, telefone }),
          });
        } else {
          await fetch(API_URL, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ nome, sobrenome, telefone }),
          });
        }
        resetForm();
        await loadDoadores();
      });

      function resetForm() {
        doadorIdInput.value = "";
        doadorNomeInput.value = "";
        doadorSobrenomeInput.value = "";
        doadorTelefoneInput.value = "";
      }

      async function loadDoadores() {
        const response = await fetch(API_URL);
        const doadores = await response.json();

        let html = "";
        for (const doador of doadores) {
          const telefone = parseFloat(doador.telefone);
          if (!isNaN(telefone)) {
            html += `
                        <tr>
                            <td>${doador.id}</td>
                            <td>${doador.nome}</td>
                            <td>${doador.sobrenome}</td>
                            <td>${telefone.toFixed(3)}</td>
                            <td>
    <button class="edit-btn btn btn-success" onclick="editarDoador(${
      doador.id
    })">Editar</button>
    <button class="delete-btn btn btn-danger" onclick="deletarDoador(${
      doador.id
    })">Deletar</button>
</td>

                        </tr>
                        `;
          } else {
            console.error("Value of telefone is not a number");
          }
        }

        doadoresTable.innerHTML = html;
      }

      async function editarDoador(id) {
        const response = await fetch(API_URL + "/" + id);
        const doador = await response.json();
        doadorIdInput.value = doador.id;
        doadorNomeInput.value = doador.nome;
        doadorSobrenomeInput.value = doador.sobrenome;
        doadorTelefoneInput.value = doador.telefone;
      }

      async function deletarDoador(id) {
        await fetch(API_URL + "/" + id, {
          method: "DELETE",
        });
        await loadDoadores();
      }

      loadDoadores();
    </script>
</body>
</html>
