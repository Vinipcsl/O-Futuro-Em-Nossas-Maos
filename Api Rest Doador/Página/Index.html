<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Doador</title>
        <style>
            table{
    width: 100%;
    border-collapse: collapse;
}
th, td{
    padding: 8px;
    text-align: center;
    border-bottom: 1px solid #000000;

}
        </style>
    </head>
    <body>
        <div class="container">
            <div class="form-container">
                <h1>Cadastro</h1>
                <form id = "doadorForm">
                    
                    <imput type ="hidden" id="doadorId">
                    <label for="nome">Nome:</label>
                    <input type="text" id="nome" required>
                    <label for="sobreNome">Sobrenome:</label>
                    <input type="text" id="sobreNome" required>
                    <label for="telefone">Telefone:</label>
                    <input type="number" id="telefone" required>
                    <button type="submit">Salvar</button>

                </form>
            </div>
        </div>

<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Nome</th>
            <th>Sobrenome</th>
            <th>Telefone</th>
        </tr>
    </thead>
    <tbody id="doadores"></tbody>
</table>

<script>
    const API_URL = 'http://localhost:3000/produtos';
    
    const doadorForm = document.getElementById('doadorForm');
    const doadorIdImput = document.getElementById('produtoId');
    const doadorNomeInput = document.getElementById('nome');
    const doadorSobrenomeInput = document.getElementById('sobreNome');
    const doadorTelefoneInput = document.getElementById('telefone');
    const doadoresTable = document.getElementById('doadores');

doadorForm.addEventListener('submit', async (event) =>{
    event.preventDefault();
    const doadorId = doadorIdImput.value;
    const nome = doadorNomeInput.value;
    const sobrenome = doadorSobrenomeInput.value;
    const telefone = doadorTelefoneInput.value;

    if(doadorId)
    {
        await fetch(API_URL + '/' + doadorId,{
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
                },
                body: JSON.stringify({nome, sobrenome, telefone})
        });
    }
    else
    {
        await fetch(API_URL,{
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
                },
                body: JSON.stringify({nome, sobrenome, telefone})
                });
    }
    resetForm();
    await loadDoadores();
});

function resetForm(){
    doadorIdImput.value = '';
    doadorNomeInput.value = '';
    doadorSobrenomeInput.value = '';
    doadorTelefoneInput.value = '';
}

async function loadDoadores(){
    const doadores = await fetch(API_URL);
    const doadoresJson = await doadores.json();

    let html= '';
    for (const doador of doadores){
        const telefone = parseFloat(doador.telefone);
        if(!isNaN(telefone)){
        html += `
        <tr>
            <td>${doador.id}</td>
            <td>${doador.nome}</td>
            <td>${doador.sobrenome}</td>
            <td>${doador.toFixed(3)}</td>
            <td>
                <button onclick="editarDoador(${doador.id})">Editar</button>
                <button onclick="deletarDoador(${doador.id})">Deletar</button>
            </td>
        </tr>
            `;
        }
    
    else{
        console.error('Value of telefone is not a number');
        }
    }
    table.innerHTML = html;
}

async function editarDoador(id){
    const doador = await fetch(API_URL + id);
    const doadorJson = await doador.json();
    doadorIdImput.value = doador.id;
    doadorNomeInput.value = doador.nome;
    doadorSobrenomeInput.value = doador.sobrenome;
    doadorTelefoneInput.value = doador.telefone;
}
async function deletarDoador(id){
    await fetch(API_URL + '/' + id,{
        method: 'DELETE'
    });
    await loadDoadores();
}
 loadDoadores();
</script>
</body>
</html>